!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).U=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,r,n,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,o)}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return r}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=s(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}var f={paints:"fill-antialias,fill-opacity,fill-color,fill-outline-color,fill-translate,fill-translate-anchor,fill-pattern,fill-extrusion-opacity,fill-extrusion-color,fill-extrusion-translate,fill-extrusion-translate-anchor,fill-extrusion-pattern,fill-extrusion-height,fill-extrusion-base,fill-extrusion-vertical-gradient,line-opacity,line-color,line-translate,line-translate-anchor,line-width,line-gap-width,line-offset,line-blur,line-dasharray,line-pattern,line-gradient,circle-radius,circle-color,circle-blur,circle-opacity,circle-translate,circle-translate-anchor,circle-pitch-scale,circle-pitch-alignment,circle-stroke-width,circle-stroke-color,circle-stroke-opacity,heatmap-radius,heatmap-weight,heatmap-intensity,heatmap-color,heatmap-opacity,icon-opacity,icon-color,icon-halo-color,icon-halo-width,icon-halo-blur,icon-translate,icon-translate-anchor,text-opacity,text-color,text-halo-color,text-halo-width,text-halo-blur,text-translate,text-translate-anchor,raster-opacity,raster-hue-rotate,raster-brightness-min,raster-brightness-max,raster-saturation,raster-contrast,raster-resampling,raster-fade-duration,hillshade-illumination-direction,hillshade-illumination-anchor,hillshade-exaggeration,hillshade-shadow-color,hillshade-highlight-color,hillshade-accent-color,background-color,background-pattern,background-opacity,sky-type,sky-atmosphere-sun,sky-atmosphere-sun-intensity,sky-gradient-center,sky-gradient-radius,sky-gradient,sky-atmosphere-halo-color,sky-atmosphere-color,sky-opacity".split(","),layouts:"visibility,fill-sort-key,circle-sort-key,line-cap,line-join,line-miter-limit,line-round-limit,line-sort-key,symbol-placement,symbol-spacing,symbol-avoid-edges,symbol-sort-key,symbol-z-order,icon-allow-overlap,icon-ignore-placement,icon-optional,icon-rotation-alignment,icon-size,icon-text-fit,icon-text-fit-padding,icon-image,icon-rotate,icon-padding,icon-keep-upright,icon-offset,icon-anchor,icon-pitch-alignment,text-pitch-alignment,text-rotation-alignment,text-field,text-font,text-size,text-max-width,text-line-height,text-letter-spacing,text-justify,text-radial-offset,text-variable-anchor,text-anchor,text-max-angle,text-writing-mode,text-rotate,text-padding,text-keep-upright,text-transform,text-offset,text-allow-overlap,text-ignore-placement,text-optional".split(",")},y=function(e){return e.replace(/[A-Z]/g,(function(e){return"-".concat(e.toLowerCase())}))},p=function(e){return e.replace(/(^|-)([a-z])/g,(function(e,t,r){return"".concat(r.toUpperCase())}))};function h(e){return String(e).match(/\.(geo)?json/)||"Feature"===e.type||"FeatureCollection"===e.type?{type:"geojson",data:e}:String(e).match(/^mapbox:\/\//)?{type:"vector",url:e}:e}var d=function(e,t){return Array.isArray(e)?e:e instanceof RegExp?t.getStyle().layers.map((function(e){return e.id})).filter((function(t){return t.match(e)})):e instanceof Function?t.getStyle().layers.filter((function(t){return e(t)})).map((function(e){return e.id})):[e]},m=function(e){return function(t){for(var r=this,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];var i=d(t,this.map);return i.forEach((function(t){return e.call.apply(e,[r,t].concat(o))}))}},v=function(e){return function(t){for(var r=this,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];var i=d(t,this.map),u=i.map((function(t){return e.call.apply(e,[r,t].concat(o))}));return function(){return u.forEach((function(e){return e()}))}}},g=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"],b=function(){function o(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n(this,"_loaded",!1),n(this,"_mapgl",null),n(this,"map",null),n(this,"hoverFeatureState",v((function(e,t,r,n,o){var u,s=this;if(Array.isArray(t)){var l=t.map((function(t){var r=i(t,2),n=r[0],o=r[1];return s.hoverFeatureState(e,n,o)}));return function(){return l.forEach((function(e){return e()}))}}if(void 0===t){var c=this.getLayerStyle(e);t=c.source,r=c["source-layer"]}var f=function(e){u&&s.map.setFeatureState({source:t,sourceLayer:r,id:u},{hover:e})},y=function(e){var t=e.features[0];t&&t.id===u||(f(!1),t&&(u&&o&&o(a(a({},e),{},{oldFeatureId:u})),u=t.id,f(!0),n&&n(e)))},p=function(e){f(!1),e&&e.oldFeatureId&&(e.oldFeatureId=u),u=void 0,o&&o(e)};return this.map.on("mousemove",e,y),this.map.on("mouseleave",e,p),function(){s.map.off("mousemove",e,y),s.map.off("mouseleave",e,p),p()}}))),n(this,"clickLayer",v((function(e,t){var r=this,n=function(n){n.features=r.map.queryRenderedFeatures(n.point,{layers:[e]}),t(n)};return this.map.on("click",e,n),function(){return r.map.off("click",e,n)}}))),n(this,"hoverLayer",v((function(e,t){var r=this,n=function(n){n.features=r.map.queryRenderedFeatures(n.point,{layers:[e]}),t(n)};return this.map.on("click",e,n),function(){return r.map.off("click",e,n)}}))),n(this,"removeLayer",m((function(e){var t=function(e){e.error.message.match(/does not exist/)||console.error(e.error)};this.map.once("error",t),this.map.removeLayer(e),this.map.off("error",t)}))),n(this,"setProperty",m((function(t,r,n){var o=this;if("object"===e(r))Object.keys(r).forEach((function(e){return o.setProperty(t,e,r[e])}));else{var a=y(r);!function(e){return f.paints.indexOf(e)>=0}(a)?function(e){return f.layouts.indexOf(e)>=0}(a)&&this.map.setLayoutProperty(t,a,n):this.map.setPaintProperty(t,a,n)}}))),n(this,"setLayerStyle",m((function(t,r){var n=this,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).forEach((function(e){e in r||n.setProperty(t,e,void 0)}))};"object"!==e(t)||Array.isArray(t)||!t.id||r||(t=(r=t).id);var i=this.getLayerStyle(t),u=this.properties(r);o(i.paint,u.paint),o(i.layout,u.layout),this.setProperty(t,a(a({},u.paint),u.layout))}))),n(this,"show",m((function(e){this.setVisibility(e,"visible")}))),n(this,"hide",m((function(e){this.setVisibility(e,"none")}))),n(this,"toggle",m((function(e,t){this.setVisibility(e,t?"visible":"none")}))),n(this,"showSource",m((function(e){this.setVisibility(this.layersBySource(e),"visible")}))),n(this,"hideSource",m((function(e){this.setVisibility(this.layersBySource(e),"none")}))),n(this,"toggleSource",m((function(e,t){this.setVisibility(this.layersBySource(e),t?"visible":"none")}))),n(this,"setFilter",m((function(e,t){this.map.setFilter(e,t)}))),n(this,"removeSource",m((function(e){var t=this.layersBySource(e);this.removeLayer(t),this.map.getSource(e)&&this.map.removeSource(e)}))),n(this,"setLayerSource",m((function(e,t,r){var n=this.map.getStyle().layers,o=n.findIndex((function(t){return t.id===e})),a=n[o],i=n[o+1]&&n[o+1].id;a.source=t,r?a["source-layer"]=r:void 0!==r&&delete a["source-layer"],this.map.removeLayer(e),this._mapAddLayerBefore(a,i)})))}var s,l,p,b,k;return s=o,l=[{key:"hoverPointer",value:function(e){var t,r=this,n=d(e,this.map),o=function(e){return r.map.getCanvas().style.cursor="pointer"},a=function(e){0===r.map.queryRenderedFeatures(e.point,{layers:n}).length&&(r.map.getCanvas().style.cursor=i)},i=this.map.getCanvas().style.cursor,u=c(n);try{for(u.s();!(t=u.n()).done;){var s=t.value;this.map.on("mouseleave",s,a),this.map.on("mouseenter",s,o)}}catch(e){u.e(e)}finally{u.f()}return function(){var e,t=c(n);try{for(t.s();!(e=t.n()).done;){var u=e.value;r.map.off("mouseenter",u,o),r.map.off("mouseleave",u,a)}}catch(e){t.e(e)}finally{t.f()}r.map.getCanvas().style.cursor=i}}},{key:"hoverPopup",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._mapgl)throw"Mapbox GL JS or MapLibre GL JS object required when initialising";var n=new this._mapgl.Popup(a({closeButton:!1},r));return v((function(e,t){var r=this,o=function(e){e.features[0]&&(n.setLngLat(e.lngLat),n.setHTML(t(e.features[0],n)),n.addTo(r.map))},a=function(e){n.remove()};return this.map.on("mouseenter",e,o),this.map.on("mouseout",e,a),function(){r.map.off("mouseenter",e,o),r.map.off("mouseout",e,a),a()}})).call(this,e,t)}},{key:"clickPopup",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._mapgl)throw"Mapbox GL JS or Maplibre GL JS object required when initialising";var n=new this._mapgl.Popup(a({},r));return v((function(e,t){var r=this,o=function(e){e.features[0]&&(n.setLngLat(e.features[0].geometry.coordinates.slice()),n.setHTML(t(e.features[0],n)),n.addTo(r.map))};return this.map.on("click",e,o),function(){return r.map.off("click",e,o)}})).call(this,e,t)}},{key:"clickOneLayer",value:function(e,t,r){var n=this,o=d(e,this.map),a=function(e){var a,i=!1,u=c(o);try{for(u.s();!(a=u.n()).done;){var s=a.value,l=n.map.queryRenderedFeatures(e.point,{layers:[s]});if(l[0])try{t({event:e,layer:s,feature:l[0],features:l})}finally{i=!0;break}}}catch(e){u.e(e)}finally{u.f()}!i&&r&&r(e)};return this.map.on("click",a),function(){return n.map.off("click",a)}}},{key:"_mapAddLayerBefore",value:function(e,t){t?this.map.addLayer(e,t):this.map.addLayer(e)}},{key:"addLayer",value:function(e,t,r,n,o){return this._mapAddLayerBefore(this.layerStyle(e,t,r,n),o),this._makeSource(t)}},{key:"add",value:function(e,t,r,n,o){if(this._mapAddLayerBefore(a(a({},this.properties(n)),{},{id:e,type:r,source:h(t)}),o),"string"==typeof t)return this._makeSource(t)}},{key:"setLayer",value:function(e,t,r,n,o){var a=this.layerStyle(e,t,r,n),i=this.map.getStyle(),u=i.layers.findIndex((function(e){return e.id===a.id}));if(i.layers.findIndex((function(e){return e.id===o})),u>=0){this.map.removeLayer(a.id);var s=o;!o&&i.layers[u+1]&&(s=i.layers[u+1].id),this.map.addLayer(a,s)}else this.map.addLayer(a,o||void 0);return this._makeSource(t)}},{key:"addLineLayer",value:function(e,t,r){}},{key:"addFillLayer",value:function(e,t,r){}},{key:"addCircleLayer",value:function(e,t,r){}},{key:"addSymbolLayer",value:function(e,t,r){}},{key:"addVideoLayer",value:function(e,t,r){}},{key:"addRasterLayer",value:function(e,t,r){}},{key:"addFillExtrusionLayer",value:function(e,t,r){}},{key:"addHeatmapLayer",value:function(e,t,r){}},{key:"addHillshadeLayer",value:function(e,t,r){}},{key:"addGeoJSONSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"FeatureCollection",features:[]},r=arguments.length>2?arguments[2]:void 0;return this.addSource(e,a({type:"geojson",data:t},r))}},{key:"addGeoJSON",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"FeatureCollection",features:[]},r=arguments.length>2?arguments[2]:void 0;return this.addGeoJSONSource(e,t,r)}},{key:"addSource",value:function(e,t){var r=this.map.getStyle();return r.sources[e]=t,this.map.setStyle(r),this._makeSource(e)}},{key:"layersBySource",value:function(e){return this.map.getStyle().layers.filter((function(t){return t.source===e})).map((function(e){return e.id}))}},{key:"addVectorSource",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof t?t.match(/\{z\}/)?this.addSource(e,a(a({},r),{},{type:"vector",tiles:[t]})):this.addSource(e,a(a({},r),{},{type:"vector",url:t})):this.addSource(e,a(a({},t),{},{type:"vector"}))}},{key:"addVector",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.addVectorSource(e,t,r)}},{key:"addRasterSource",value:function(e,t){return this.addSource(e,a(a({},t),{},{type:"raster"}))}},{key:"addRasterDemSource",value:function(e,t){return this.addSource(e,a(a({},t),{},{type:"raster-dem"}))}},{key:"addImageSource",value:function(e,t){return this.addSource(e,a(a({},t),{},{type:"image"}))}},{key:"addVideoSource",value:function(e,t){return this.addSource(e,a(a({},t),{},{type:"video"}))}},{key:"properties",value:function(e){if(e){var t={},r={paint:{},layout:{},other:{}};return Object.keys(e).forEach((function(t){var n=y(t);r[function(e){return f.paints.indexOf(e)>=0?"paint":f.layouts.indexOf(e)>=0?"layout":"other"}(n)][n]=e[t]})),Object.keys(r.paint).length&&(t.paint=r.paint),Object.keys(r.layout).length&&(t.layout=r.layout),Object.assign(t,r.other),t}}},{key:"layerStyle",value:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r[0],a=r[1],i=r[2],u=r.find((function(t){return"object"===e(t)&&!Array.isArray(t)})),s="object"===e(u)&&this.properties(u)||{};return"string"==typeof o&&(s.id=o),"string"==typeof a&&(s.source=a),"string"==typeof i&&(s.type=i),s}},{key:"getLayerStyle",value:function(e){return this.map.getStyle().layers.find((function(t){return t.id===e}))}},{key:"setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"FeatureCollection",features:[]};this.map.getSource(e).setData(t)}},{key:"onLoad",value:function(e){var t=this;if(!e)return new Promise((function(e){return t.onLoad(e)}));this.map.loaded()||this._loaded?e():this.map.once("load",(function(){t._loaded=!0,e()}))}},{key:"setRootProperty",value:function(e,t){var r=this.map.getStyle();r[y(e)]=t,this.map.setStyle(r)}},{key:"setTransition",value:function(e){this.setRootProperty("transition",e)}},{key:"loadImage",value:function(e,t,r){var n=this;return"string"==typeof t?new Promise((function(o,a){n.map.loadImage(t,(function(i,u){i?(console.error("Error loading image ".concat(t),i),a("Error loading image ".concat(t))):(n.map.addImage(e,u,r),o(e))}))})):this.map.addImage(e,t,r)}},{key:"lockOrientation",value:function(){this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable()}},{key:"fontsInUse",value:function(){function e(t){Array.isArray(t)&&("literal"===t[0]?r.push.apply(r,u(t[1])):t.forEach(e))}var t,r=[],n=c(this.map.getStyle().layers.map((function(e){return e.layout&&e.layout["text-font"]})).filter(Boolean));try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.stops)try{r.push.apply(r,u(o.stops.flat().filter(Array.isArray).flat()))}catch(e){console.log("Couldn't process font expression:",o)}else o.every((function(e){return"string"==typeof e}))?r.push.apply(r,u(o)):e(o)}}catch(e){n.e(e)}finally{n.f()}return u(new Set(r))}},{key:"_makeSource",value:function(e){var t=new o;return t.map=this.map,t._mapgl=this._mapgl,g.forEach((function(r){S(r,t,e)})),t}}],p=[{key:"init",value:function(e,t){return e.U=new o,e.U._mapgl=t,e.U.map=e,e.U}},{key:"newMap",value:(b=regeneratorRuntime.mark((function e(t){var r,n,i,s,l,c,f,y,p,h,d,m,v=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(r).forEach((function(n){var o=r[n].layers;delete r[n].layers,e.sources[n]=r[n],e.layers=[].concat(u(e.layers),u(o.map((function(e){return t.layerStyle(a({source:n},e))}))))}))},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};e=t(e)},s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.sources=a(a({},e.sources),t)},i=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.layers=[].concat(u(e.layers),u(r.map((function(e){return t.layerStyle(e)}))))},r=v.length>1&&void 0!==v[1]?v[1]:{},n=v.length>2&&void 0!==v[2]?v[2]:{},r.style||(r.style={version:8,layers:[],sources:{}}),!(n.addLayers||n.addSources||n.transformStyle||n.mixStyles)){e.next=26;break}if("string"!=typeof(f=r.style)){e.next=19;break}return p=f.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/"),e.next=13,fetch(p);case 13:return h=e.sent,e.next=16,h.json();case 16:y=e.sent,e.next=20;break;case 19:y=f;case 20:d=new o,i.call(d,y,n.addLayers),s(y,n.addSources),l(y,n.transformStyle),c.call(d,y,n.mixStyles),r.style=y;case 26:return m=new t.Map(r),o.init(m,t),e.abrupt("return",m);case 29:case"end":return e.stop()}}),e)})),k=function(){var e=this,r=arguments;return new Promise((function(n,o){var a=b.apply(e,r);function i(e){t(a,n,o,i,u,"next",e)}function u(e){t(a,n,o,i,u,"throw",e)}i(void 0)}))},function(e){return k.apply(this,arguments)})}],l&&r(s.prototype,l),p&&r(s,p),o}(),S=function(e,t,r){var n;n=r?function(t,n,o){return this.setLayer(t,r,e,n,o)}:function(t,r,n,o){return this.setLayer(t,r,e,n,o)};var o=p(e);t["add".concat(o)]=n,t["add".concat(o,"Layer")]=n};return function(e){var t=function(t,r){var n="set"+p(t);e[n]=m((function(e,n){return this.map[r](e,t,n)}))},r=function(t,r){var n="get"+p(t);e[n]=m((function(e){return this.map[r](e,t)}))};e.update=e.setData,f.paints.forEach((function(e){return t(e,"setPaintProperty")})),f.layouts.forEach((function(e){return t(e,"setLayoutProperty")})),f.paints.forEach((function(e){return r(e,"getPaintProperty")})),f.layouts.forEach((function(e){return r(e,"getLayoutProperty")})),g.forEach((function(t){return S(t,e)}))}(b.prototype),b}));
